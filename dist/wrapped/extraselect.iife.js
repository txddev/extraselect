var Extraselect=function(e){"use strict";const b=new WeakMap;class S{static put(o,n,l){b.has(o)||b.set(o,new Map),b.get(o).set(n,l)}static get(o,n){return b.get(o).get(n)}static has(o,n){return b.has(o)&&b.get(o).has(n)}static remove(o,n){var l=b.get(o).delete(n);return!b.get(o).size===0&&b.delete(o),l}static lock(o,n,l){return S.has(o,n)?!1:(S.put(o,n,!0),l())}}window.__Store=b;var A;const N=typeof window<"u";N&&((A=window==null?void 0:window.navigator)==null?void 0:A.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function J(t){return typeof t=="function"?t():e.unref(t)}function K(t){return t}function X(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function Y(t,o=!0){e.getCurrentInstance()?e.onMounted(t):o?t():e.nextTick(t)}function M(t){var o;const n=J(t);return(o=n==null?void 0:n.$el)!=null?o:n}const Z=N?window:void 0;N&&window.document,N&&window.navigator,N&&window.location;function ee(t,o=!1){const n=e.ref(),l=()=>n.value=Boolean(t());return l(),Y(l,o),n}const P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},T="__vueuse_ssr_handlers__";P[T]=P[T]||{},P[T];var j=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,oe=(t,o)=>{var n={};for(var l in t)te.call(t,l)&&o.indexOf(l)<0&&(n[l]=t[l]);if(t!=null&&j)for(var l of j(t))o.indexOf(l)<0&&ne.call(t,l)&&(n[l]=t[l]);return n};function le(t,o,n={}){const l=n,{window:r=Z}=l,a=oe(l,["window"]);let s;const i=ee(()=>r&&"ResizeObserver"in r),u=()=>{s&&(s.disconnect(),s=void 0)},p=e.watch(()=>M(t),f=>{u(),i.value&&r&&f&&(s=new ResizeObserver(o),s.observe(f,a))},{immediate:!0,flush:"post"}),h=()=>{u(),p()};return X(h),{isSupported:i,stop:h}}function ae(t,o={width:0,height:0},n={}){const{box:l="content-box"}=n,r=e.ref(o.width),a=e.ref(o.height);return le(t,([s])=>{const i=l==="border-box"?s.borderBoxSize:l==="content-box"?s.contentBoxSize:s.devicePixelContentBoxSize;i?(r.value=i.reduce((u,{inlineSize:p})=>u+p,0),a.value=i.reduce((u,{blockSize:p})=>u+p,0)):(r.value=s.contentRect.width,a.value=s.contentRect.height)},n),e.watch(()=>M(t),s=>{r.value=s?o.width:0,a.value=s?o.height:0}),{width:r,height:a}}var z;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(z||(z={}));var re=Object.defineProperty,$=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,D=(t,o,n)=>o in t?re(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,ie=(t,o)=>{for(var n in o||(o={}))se.call(o,n)&&D(t,n,o[n]);if($)for(var n of $(o))ce.call(o,n)&&D(t,n,o[n]);return t};ie({linear:K},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});function ue(t,o){const n=e.ref(),l=ae(n),r=e.ref([]),a=e.shallowRef(t),s=e.ref({start:0,end:10}),{itemHeight:i,overscan:u=5}=o,p=g=>{if(typeof i=="number")return Math.ceil(g/i);const{start:E=0}=s.value;let y=0,v=0;for(let _=E;_<a.value.length;_++)if(y+=i(_),y>=g){v=_;break}return v-E},h=g=>{if(typeof i=="number")return Math.floor(g/i)+1;let E=0,y=0;for(let v=0;v<a.value.length;v++)if(E+=i(v),E>=g){y=v;break}return y+1},f=()=>{const g=n.value;if(g){const E=h(g.scrollTop),y=p(g.clientHeight),v=E-u,_=E+y+u;s.value={start:v<0?0:v,end:_>a.value.length?a.value.length:_},r.value=a.value.slice(s.value.start,s.value.end).map((B,F)=>({data:B,index:F+s.value.start}))}};e.watch([l.width,l.height,t],()=>{f()});const O=e.computed(()=>typeof i=="number"?a.value.length*i:a.value.reduce((g,E,y)=>g+i(y),0)),w=g=>typeof i=="number"?g*i:a.value.slice(0,g).reduce((y,v,_)=>y+i(_),0),k=g=>{n.value&&(n.value.scrollTop=w(g),f())},x=e.computed(()=>w(s.value.start)),C=e.computed(()=>({style:{width:"100%",height:`${O.value-x.value}px`,marginTop:`${x.value}px`}}));return{list:r,scrollTo:k,containerProps:{ref:n,onScroll:()=>{f()},style:{overflowY:"auto"}},wrapperProps:C}}const I=function(t){if(t==null)return{top:0,left:0};let o=t.getBoundingClientRect();return{top:o.top+window.scrollY,left:o.left+window.scrollX,width:o.width,height:o.height}},Q=function(t,o){o===void 0&&(o=document);for(var n=[],l=t.parentNode;l!==o;){var r=l;n.push(r),l=r.parentNode}return n.push(o),n},de=function(t){var o=Array.prototype.slice.call(t.childNodes);o.forEach(function(n){t.removeChild(n)})},fe=(t,o)=>{window.ExtraSelectOptions==null&&(window.ExtraSelectOptions={});const n={defaultArray:t.value,get:()=>t.value,push:(l,r,a=null)=>{const s=t.value.find(i=>i.key==l);s?(s.value=r,s.data=a):t.value.push({value:r,key:l,data:a})},addRange:l=>{for(let r of l)t.actions.push(r.key,r.value,r.data)},remove:l=>{t.value.splice(t.value.findIndex(r=>r.key==l),1)},clear:()=>{t.value=[]},sort:(l=null)=>{l==null&&(l=(r,a)=>r.value.localeCompare(a.value)),t.value=t.value.sort(l)},setDefault:function(l){this.defaultArray=l},restoreDefault:function(){t.value=this.defaultArray},filter:function(l){}};window.ExtraSelectOptions[o]=n,t.actions=n};let pe=1;const he=t=>{t&&(t.style.display="none",de(t))},me=(t,o,n,l)=>{var s,i;const r=e.ref([]);e.watchEffect(()=>{r.value=n});const a=e.ref([]);return e.watchEffect(()=>{a.value=o}),t&&(r.value=Array.apply(null,t.selectedOptions).map(u=>u.value).filter(u=>u),a.value=Array.apply(null,t.options).reduce((u,p)=>(u.push({value:p.text,key:p.value,data:p.dataset}),u),[])),fe(a,(i=(s=t==null?void 0:t.id)!=null?s:l)!=null?i:"extraselect_"+(++pe).toString()),{options:a,selectedOptions:r}},q=async function(t,o=null,n={}){var a;const l={method:"POST",credentials:"include",...n,headers:{"Content-Type":"application/json",...(a=n.headers)!=null?a:{}},body:JSON.stringify({search:o,...n.body})};return await(await fetch(t,l)).json()},ge=(t,o,n,l,r,a="limited",s={})=>{const i=e.ref(0),u=e.ref(!1),p=e.computed(()=>u.value||i.value>0);if(o!=null&&o.length>0)if(n){const h=[];e.watchEffect(f=>{if(l.value.length>=r){let O=!0;switch(a){case"always":break;default:case"limited":O=!h.includes(l.value);break;case"complete":O=h.reduce((w,k)=>w&&!l.value.startsWith(k),!0);break}if(O){u.value=!0;const w=setTimeout(()=>{h.push(l.value),i.value+=1,q(o,l.value,s).then(k=>{t.actions.addRange(k),t.actions.sort(),i.value-=1,u.value=!1})},500);f(()=>{clearTimeout(w)})}}})}else q(o,null,s).then(h=>{t.actions.addRange(h),t.actions.sort()});return{searchingFlag:p}},ye=(t,o)=>{const n=e.ref(""),l=e.ref([]),r=function(a,s){return a.value.filter(u=>s.length>0?u.value.toLowerCase().includes(s.toLowerCase()):!0)};return e.watchEffect(()=>{n.value.length>=o?l.value=r(t,n.value):l.value=[]}),{filterText:n,filteredOptions:l}},we=(t,o,n,l,r,a,s)=>{const i=function(h,f){const w=document.createElement("canvas").getContext("2d");return w.font=f,w.measureText(h).width},u=e.computed(()=>{var f;const h=(f=I(l.value).width)!=null?f:100;if(s==="inherit")return h;if(s==null||s==="dynamic"){const O=getComputedStyle(document.querySelector("body")).font;return Math.max(h,Math.max(...t.value.map(w=>i(w.value,O)))+15)}return s}),p=e.ref({position:"absolute","min-width":"max-content"});return e.watchPostEffect(()=>{n.value<0&&console.log("is open"),o.value.length<0&&console.log("empty selection");var h=I(l.value),f=I(null);if(a.value&&["absolute","relative","fixed","sticky"].includes(getComputedStyle(a.value).position))var f=I(a.value);p.value={position:"absolute","min-width":"max-content",width:u.value.toString()+"px",top:(-f.top+h.top+h.height).toString()+"px",left:(-f.left+h.left).toString()+"px"}}),{dropdownStyle:p}},ke={key:0,class:"extra-select selection"},ve=["onClick"],_e=["innerHTML"],Oe=["value"],Ee={key:0,class:"input-searching"},be={key:0,class:"allselect-clear"},xe={class:"row-input"},Ce=["checked"],Se=e.createElementVNode("b",null,"Select all",-1),Ne={class:"row-input"},Be=["checked"],Ve=e.createElementVNode("b",null,"Select Filtered",-1),Ie={key:1,class:"no-matches"},Pe={key:2},Te=["onClick"],Le={class:"row-input"},Fe=["checked"],Ae=["value"],Me={__name:"ExtraSelect",props:{originalNode:{type:Object,required:!1},multiple:{type:Boolean,required:!1},options:{type:Array,required:!1},modelValue:{type:Array,required:!1},url:{type:String,required:!1},maxWidth:{type:String,default:"dynamic"},search:{type:Boolean,default:!0},searchableUrl:{type:Boolean,default:!1},minChars:{type:Number,default:0},showSelected:{type:Boolean,default:!1},fetchMode:{type:String,default:"limited"},fetchOptions:{type:Object,default:{}},removeIcon:{type:String,default:"X"},dropdownContainer:{type:String,default:null}},emits:["update:modelValue"],setup(t,{emit:o}){var U,W,R;const n=t,l=e.computed(()=>{var c,d;return(d=(c=n.originalNode)==null?void 0:c.multiple)!=null?d:n.multiple}),{options:r,selectedOptions:a}=me(n.originalNode,n.options,n.modelValue),s=(U=n.originalNode)==null?void 0:U.classList,i=Object.values((R=(W=n.originalNode)==null?void 0:W.style)!=null?R:{});he(n.originalNode);const{filterText:u,filteredOptions:p}=ye(r,n.minChars),{searchingFlag:h}=ge(r,n.url,n.searchableUrl,u,n.minChars,n.fetchMode,n.fetchOptions),f=e.ref(null),O=e.ref(null),w=e.ref(null),k=e.ref(!1),x=e.ref(null),C=function(c){const d=Q(c.target);d.push(c.target),!d.includes(f.value)&&!d.includes(O.value)&&(k.value=!1)};e.onMounted(()=>{if(n.dropdownContainer){let c=!1;x.value=Q(f.value).find(d=>!!(d instanceof Element&&(d.matches(n.dropdownContainer)&&(c=!0),c&&["absolute","relative","fixed","sticky"].includes(getComputedStyle(d).position))))}if(x.value==null&&(x.value=document.querySelector("body")),n.originalNode){for(let c of s)c!="extraselect"&&f.value.classList.add(c);for(let c of i)f.value.style[c]=n.originalNode.style[c];i.includes("background-color")||(f.value.style.backgroundColor="white")}window.document.addEventListener("mousedown",C),window.document.addEventListener("focusin",C)}),e.onUnmounted(()=>{window.document.removeEventListener("mousedown",C),window.document.removeEventListener("focusin",C)});const{dropdownStyle:H}=we(r,a,k,f,O,x,n.maxWidth),g=c=>{console.log("toggling",c),l.value?a.value.includes(c)?a.value.splice(a.value.indexOf(c),1):a.value.push(c):(a.value=[c],k.value=!1),o("update:modelValue",a.value)},E=c=>{y(c,!1),u.value=""},y=(c,d=null)=>{d==null&&(d=!_.value),d?a.value=r.value.map(m=>m.key):a.value=[],o("update:modelValue",a.value)},v=()=>{B.value?p.value.forEach(c=>{a.value.includes(c.key)&&a.value.splice(a.value.indexOf(c.key),1)}):p.value.forEach(c=>{a.value.includes(c.key)||a.value.push(c.key)}),o("update:modelValue",a.value)};e.watch(k,(c,d)=>{c!=d&&(c?n.search&&e.nextTick(()=>{w.value.focus({focusVisible:!0})}):u.value="")});const _=e.computed(()=>a.value.length==r.value.length),B=e.computed(()=>p.value.reduce((c,d)=>c&&a.value.includes(d.key),!0));e.computed(()=>a.value.length==0);const F=e.computed(()=>{const c=a.value.map(d=>{var m;return(m=r.value.find(V=>V.key==d))==null?void 0:m.value}).join(", ");return c.length>0?c:"--"}),{list:je,containerProps:ze,wrapperProps:$e}=ue(p,{itemHeight:32});return(c,d)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.showSelected?(e.openBlock(),e.createElementBlock("div",ke,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),m=>{var V;return e.openBlock(),e.createElementBlock("div",{key:m,onClick:G=>g(m),class:"selection-badge"},[e.createTextVNode(e.toDisplayString((V=e.unref(r).find(G=>G.key==m))==null?void 0:V.value)+" ",1),e.createElementVNode("div",{class:"selection-remove",innerHTML:n.removeIcon},null,8,_e)],8,ve)}),128))])):e.createCommentVNode("",!0),e.createElementVNode("input",{onFocus:d[0]||(d[0]=m=>k.value=!0),onClick:d[1]||(d[1]=m=>k.value=!0),ref_key:"inputNode",ref:f,value:e.unref(F),class:"extra-select extra-select-input",readonly:""},null,40,Oe),x.value?(e.openBlock(),e.createBlock(e.Teleport,{key:1,to:x.value},[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass(["extra-select dropdown",{searching:e.unref(h)>0}]),ref_key:"dropdownNode",ref:O,style:e.normalizeStyle(e.unref(H))},[n.search?(e.openBlock(),e.createElementBlock("div",Ee,[e.withDirectives(e.createElementVNode("input",{ref_key:"searchNode",ref:w,class:"extra-select-search","onUpdate:modelValue":d[2]||(d[2]=m=>e.isRef(u)?u.value=m:null),type:"text",autocomplete:"off",autocorrect:"off",autocapitilize:"off",spellcheck:"false",placeholder:"Cerca..."},null,512),[[e.vModelText,e.unref(u)]])])):e.createCommentVNode("",!0),e.unref(u).length>=n.minChars?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(l)?(e.openBlock(),e.createElementBlock("div",be,[e.unref(u).length==0?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:y,class:"all-select"},[e.createElementVNode("div",xe,[e.createElementVNode("input",{checked:e.unref(_),type:"checkbox"},null,8,Ce),Se])])):e.createCommentVNode("",!0),e.unref(p).length>0&&e.unref(u).length>0?(e.openBlock(),e.createElementBlock("div",{key:1,onClick:v,class:"all-select"},[e.createElementVNode("div",Ne,[e.createElementVNode("input",{checked:e.unref(B),type:"checkbox"},null,8,Be),Ve])])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"clear",onClick:E},"Clear")])):e.createCommentVNode("",!0),e.unref(p).length==0?(e.openBlock(),e.createElementBlock("div",Ie,"No matches found")):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("div",Pe,"Insert at least "+e.toDisplayString(n.minChars)+" characters",1)),e.createElementVNode("div",e.mergeProps(e.unref(ze),{class:"scroller"}),[e.createElementVNode("div",e.normalizeProps(e.guardReactiveProps(e.unref($e))),[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(je),m=>(e.openBlock(),e.createElementBlock("button",{key:m.index,class:"dropdown-row",onClick:e.withModifiers(V=>g(m.data.key),["stop","prevent"]),style:{height:"32px"}},[e.createElementVNode("div",Le,[e.unref(l)?(e.openBlock(),e.createElementBlock("input",{key:0,checked:e.unref(a).includes(m.data.key),type:"checkbox"},null,8,Fe)):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(m.data.value),1)])],8,Te))),128))],16)],16)],6),[[e.vShow,k.value]])],8,["to"])):e.createCommentVNode("",!0),n.originalNode?(e.openBlock(),e.createBlock(e.Teleport,{key:2,to:n.originalNode},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),m=>(e.openBlock(),e.createElementBlock("option",{key:m,selected:"selected",value:m},null,8,Ae))),128))],8,["to"])):e.createCommentVNode("",!0)],64))}},L={init:function(){document.querySelectorAll(".extraselect").forEach(function(t){L.bindNew(t)})},bindNew(t){S.lock(t,"extra-select",()=>{const o={};for(let r in t.dataset)try{o[r]=JSON.parse(t.dataset[r])}catch{o[r]=t.dataset[r]}o.originalNode=t;const n=document.createElement("div");t.parentNode.insertBefore(n,t.nextSibling),n.dataset.isVue=!0;const l=e.createApp(Me,o);l.mount(n),t.addEventListener("remove",function(){l.unmount(),n.remove(),t.remove(),S.remove(t,"extra-select")})})}};return document.addEventListener("DOMContentLoaded",function(){L.init()}),L}(Vue);
