var Extraselect=function(e){"use strict";const C=new WeakMap;class B{static put(l,n,a){C.has(l)||C.set(l,new Map),C.get(l).set(n,a)}static get(l,n){return C.get(l).get(n)}static has(l,n){return C.has(l)&&C.get(l).has(n)}static remove(l,n){var a=C.get(l).delete(n);return C.get(l).size!==0&&C.delete(l),a}static lock(l,n,a){return B.has(l,n)?!1:(B.put(l,n,!0),a())}}({BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}).DATASTORE_DEBUG&&(window.__Store=C);function T(t){if(t==null)return{top:0,left:0,width:null,height:null};let l=t.getBoundingClientRect();return{top:l.top+window.scrollY,left:l.left+window.scrollX,width:l.width,height:l.height}}function z(t,l){l===void 0&&(l=window.document);for(var n=[],a=t.parentNode;a!=null&&a!==l;){var r=a;n.push(r),a=r.parentNode}return n.push(l),n}function J(t){var l=Array.prototype.slice.call(t.childNodes);l.forEach(function(n){t.removeChild(n)})}var F;const V=typeof window<"u";V&&((F=window==null?void 0:window.navigator)==null?void 0:F.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function K(t){return typeof t=="function"?t():e.unref(t)}function X(t){return t}function Y(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function Z(t,l=!0){e.getCurrentInstance()?e.onMounted(t):l?t():e.nextTick(t)}function D(t){var l;const n=K(t);return(l=n==null?void 0:n.$el)!=null?l:n}const ee=V?window:void 0;V&&window.document,V&&window.navigator,V&&window.location;function te(t,l=!1){const n=e.ref(),a=()=>n.value=Boolean(t());return a(),Z(a,l),n}const L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A="__vueuse_ssr_handlers__";L[A]=L[A]||{},L[A];var j=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,oe=(t,l)=>{var n={};for(var a in t)ne.call(t,a)&&l.indexOf(a)<0&&(n[a]=t[a]);if(t!=null&&j)for(var a of j(t))l.indexOf(a)<0&&le.call(t,a)&&(n[a]=t[a]);return n};function ae(t,l,n={}){const a=n,{window:r=ee}=a,o=oe(a,["window"]);let s;const d=te(()=>r&&"ResizeObserver"in r),c=()=>{s&&(s.disconnect(),s=void 0)},f=e.watch(()=>D(t),p=>{c(),d.value&&r&&p&&(s=new ResizeObserver(l),s.observe(p,o))},{immediate:!0,flush:"post"}),k=()=>{c(),f()};return Y(k),{isSupported:d,stop:k}}function re(t,l={width:0,height:0},n={}){const{box:a="content-box"}=n,r=e.ref(l.width),o=e.ref(l.height);return ae(t,([s])=>{const d=a==="border-box"?s.borderBoxSize:a==="content-box"?s.contentBoxSize:s.devicePixelContentBoxSize;d?(r.value=d.reduce((c,{inlineSize:f})=>c+f,0),o.value=d.reduce((c,{blockSize:f})=>c+f,0)):(r.value=s.contentRect.width,o.value=s.contentRect.height)},n),e.watch(()=>D(t),s=>{r.value=s?l.width:0,o.value=s?l.height:0}),{width:r,height:o}}var W;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(W||(W={}));var se=Object.defineProperty,$=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,R=(t,l,n)=>l in t?se(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,ue=(t,l)=>{for(var n in l||(l={}))ce.call(l,n)&&R(t,n,l[n]);if($)for(var n of $(l))ie.call(l,n)&&R(t,n,l[n]);return t};ue({linear:X},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});function de(t,l){const n=e.ref(),a=re(n),r=e.ref([]),o=e.shallowRef(t),s=e.ref({start:0,end:10}),{itemHeight:d,overscan:c=5}=l,f=y=>{if(typeof d=="number")return Math.ceil(y/d);const{start:E=0}=s.value;let v=0,_=0;for(let b=E;b<o.value.length;b++)if(v+=d(b),v>=y){_=b;break}return _-E},k=y=>{if(typeof d=="number")return Math.floor(y/d)+1;let E=0,v=0;for(let _=0;_<o.value.length;_++)if(E+=d(_),E>=y){v=_;break}return v+1},p=()=>{const y=n.value;if(y){const E=k(y.scrollTop),v=f(y.clientHeight),_=E-c,b=E+v+c;s.value={start:_<0?0:_,end:b>o.value.length?o.value.length:b},r.value=o.value.slice(s.value.start,s.value.end).map((N,P)=>({data:N,index:P+s.value.start}))}};e.watch([a.width,a.height,t],()=>{p()});const w=e.computed(()=>typeof d=="number"?o.value.length*d:o.value.reduce((y,E,v)=>y+d(v),0)),m=y=>typeof d=="number"?y*d:o.value.slice(0,y).reduce((v,_,b)=>v+d(b),0),g=y=>{n.value&&(n.value.scrollTop=m(y),p())},O=e.computed(()=>m(s.value.start)),x=e.computed(()=>({style:{width:"100%",height:`${w.value-O.value}px`,marginTop:`${O.value}px`}}));return{list:r,scrollTo:g,containerProps:{ref:n,onScroll:()=>{p()},style:{overflowY:"auto"}},wrapperProps:x}}const fe=(t,l)=>{window.ExtraSelectOptions==null&&(window.ExtraSelectOptions={});const n={defaultArray:t.value,get:()=>t.value,push:(a,r,o=null)=>{const s=t.map.get(a);if(s)s.value=r,s.data=o;else{let d={value:r,key:a,data:o};t.value.push(d),t.map.set(d.key,d)}},addRange:a=>{for(let r of a)t.actions.push(r.key,r.value,r.data)},remove:a=>{t.value.splice(t.value.findIndex(r=>r.key==a),1)},clear:()=>{t.value=[]},sort:(a=null)=>{a==null&&(a=(r,o)=>r.value.localeCompare(o.value)),t.value=t.value.sort(a)},setDefault:function(a){this.defaultArray=a},restoreDefault:function(){t.value=this.defaultArray},filter:function(a){}};window.ExtraSelectOptions[l]=n,t.actions=n};let pe=1;const he=t=>{t&&(t.style.display="none",J(t))},me=(t,l,n,a)=>{var s,d;const r=e.ref(new Map);e.watchEffect(()=>{r.value.clear();for(let c of n)r.value.set(c,c)});const o=e.ref([]);if(o.map=new Map,o.rebuildMap=()=>{if(o.map.clear(),o.value)for(let c of o.value)o.map.set(c.key,c)},e.watchEffect(()=>{l&&(o.value=l,o.rebuildMap())}),t){r.value.clear();for(let c of Array.apply(null,t.selectedOptions).map(f=>f.value).filter(f=>f))r.value.set(c,c);o.value=Array.apply(null,t.options).reduce((c,f)=>(c.push({value:f.text,key:f.value,data:f.dataset}),c),[]),o.rebuildMap()}return fe(o,(d=(s=t==null?void 0:t.id)!=null?s:a)!=null?d:"extraselect_"+(++pe).toString()),{options:o,selectedOptions:r}},q=async function(t,l=null,n={}){var o;const a={method:"POST",credentials:"include",...n,headers:{"Content-Type":"application/json",...(o=n.headers)!=null?o:{}},body:JSON.stringify({search:l,...n.body})};return await(await fetch(t,a)).json()},ge=(t,l,n,a,r,o="limited",s={})=>{const d=e.ref(0),c=e.ref(!1),f=e.computed(()=>c.value||d.value>0);if(l!=null&&l.length>0)if(n){const k=[];e.watchEffect(p=>{if(a.value.length>=r){let w=!0;switch(o){case"always":break;default:case"limited":w=!k.includes(a.value);break;case"complete":w=k.reduce((m,g)=>m&&!a.value.startsWith(g),!0);break}if(w){c.value=!0;const m=setTimeout(()=>{k.push(a.value),d.value+=1,q(l,a.value,s).then(g=>{t.actions.addRange(g),t.actions.sort(),d.value-=1,c.value=!1})},500);p(()=>{clearTimeout(m)})}}})}else q(l,null,s).then(k=>{t.actions.addRange(k),t.actions.sort()});return{searchingFlag:f}},ye=(t,l)=>{const n=e.ref(""),a=e.ref([]),r=function(o,s){return console.log(o.value),o.value.filter(c=>s.length>0?c.value.toLowerCase().includes(s.toLowerCase()):!0)};return e.watchEffect(()=>{n.value.length>=l?a.value=r(t,n.value):a.value=[]}),{filterText:n,filteredOptions:a}},we=(t,l,n,a,r,o,s)=>{const d=getComputedStyle(document.querySelector("body")).font,c=function(p){const m=document.createElement("canvas").getContext("2d");return m.font=d,m.measureText(p).width},f=e.computed(()=>{var w,m;const p=(w=T(a.value).width)!=null?w:100;if(s==="inherit")return p;if(s==null||s==="dynamic"){const g=(m=parseInt(getComputedStyle(document.querySelector("html"))["font-size"]))!=null?m:16;return Math.max(p,Math.max(...t.value.map(O=>c(O.value)))+20+g*3)}return s}),k=e.ref({position:"absolute","min-width":"max-content"});return e.watchPostEffect(()=>{n.value<0&&console.log("is open"),l.value.size<0&&console.log("empty selection");var p=T(a.value),w=T(null);if(o.value&&["absolute","relative","fixed","sticky"].includes(getComputedStyle(o.value).position))var w=T(o.value);let m=-w.left+p.left;const g=window.document.documentElement.clientWidth;m+f.value>g&&(m=g-f.value),k.value={position:"absolute","min-width":"max-content",width:f.value.toString()+"px",top:(-w.top+p.top+p.height).toString()+"px",left:m.toString()+"px"}}),{dropdownStyle:k,getTextWidth:c}},ke={key:0,class:"extra-select selection"},ve=["onClick"],_e=["innerHTML"],Ee=["value"],be={key:0,class:"input-searching"},Oe={key:0,class:"allselect-clear"},Ce={class:"row-input"},Se=["checked"],xe=e.createElementVNode("b",null,"Select all",-1),Ne={class:"row-input"},Be=["checked"],Ve=e.createElementVNode("b",null,"Select Filtered",-1),Ie={key:1,class:"no-matches"},Te={key:2},Pe=["onClick"],Le={class:"row-input"},Ae=["checked"],Me=["value"],ze={__name:"ExtraSelect",props:{originalNode:{type:Object,required:!1},multiple:{type:Boolean,required:!1},options:{type:Array,required:!1},modelValue:{type:Array,required:!1,default:[]},url:{type:String,required:!1},maxWidth:{type:String,default:"dynamic"},search:{type:Boolean,default:!1},searchableUrl:{type:Boolean,default:!1},minChars:{type:Number,default:0},showSelected:{type:Boolean,default:!1},fetchMode:{type:String,default:"limited"},fetchOptions:{type:Object,default:{}},removeIcon:{type:String,default:"X"},dropdownContainer:{type:String,default:null}},emits:["update:modelValue"],setup(t,{emit:l}){var U,H,G;const n=t,a=e.computed(()=>{var i,u;return(u=(i=n.originalNode)==null?void 0:i.multiple)!=null?u:n.multiple}),{options:r,selectedOptions:o}=me(n.originalNode,n.options,n.modelValue),s=(U=n.originalNode)==null?void 0:U.classList,d=Object.values((G=(H=n.originalNode)==null?void 0:H.style)!=null?G:{});he(n.originalNode);const{filterText:c,filteredOptions:f}=ye(r,n.minChars),{searchingFlag:k}=ge(r,n.url,n.searchableUrl,c,n.minChars,n.fetchMode,n.fetchOptions),p=e.ref(null),w=e.ref(null),m=e.ref(null),g=e.ref(!1),O=e.ref(null),x=function(i){const u=z(i.target);u.push(i.target),!u.includes(p.value)&&!u.includes(w.value)&&(g.value=!1)};e.onMounted(()=>{if(n.dropdownContainer){let i=!1;O.value=z(p.value).find(u=>!!(u instanceof Element&&(u.matches(n.dropdownContainer)&&(i=!0),i&&["absolute","relative","fixed","sticky"].includes(getComputedStyle(u).position))))}if(O.value==null&&(O.value=document.querySelector("body")),n.originalNode){for(let i of s)i!="extraselect"&&p.value.classList.add(i);for(let i of d)p.value.style[i]=n.originalNode.style[i];d.includes("background-color")||(p.value.style.backgroundColor="white")}window.document.addEventListener("mousedown",x),window.document.addEventListener("focusin",x)}),e.onUnmounted(()=>{window.document.removeEventListener("mousedown",x),window.document.removeEventListener("focusin",x)});const{dropdownStyle:Q,getTextWidth:y}=we(r,o,g,p,w,O,n.maxWidth),E=i=>{a.value?o.value.has(i)?o.value.delete(i):o.value.set(i,i):(o.value.clear(),o.value.set(i,i),g.value=!1),l("update:modelValue",Array.from(o.value.keys()))},v=i=>{_(i,!1),c.value=""},_=(i,u=null)=>{u==null&&(u=!N.value),u?(o.value.clear(),r.value.forEach(h=>o.value.set(h.key,h.key))):o.value.clear(),l("update:modelValue",Array.from(o.value.keys()))},b=()=>{P.value?f.value.forEach(i=>{o.value.has(i.key)&&o.value.delete(i.key)}):f.value.forEach(i=>{o.value.has(i.key)||o.value.set(i.key,i.key)}),l("update:modelValue",Array.from(o.value.keys()))};e.watch(g,(i,u)=>{i!=u&&(i?n.search&&e.nextTick(()=>{m.value.focus({focusVisible:!0})}):c.value="")});const N=e.computed(()=>o.value.size==r.value.length),P=e.computed(()=>f.value.reduce((i,u)=>i&&o.value.has(u.key),!0)),Fe=e.computed(()=>o.value.size==0),De=e.computed(()=>{var i;if(a.value){if(N.value)return"All selected";if(Fe.value)return"No selection";const u=p.value?getComputedStyle(p.value):null,h=((i=p.value)==null?void 0:i.clientWidth)-parseInt(u==null?void 0:u.paddingLeft)-parseInt(u==null?void 0:u.paddingRight);let S=o.value.size+" selected - ",I=!0;for(let Re of o.value)if(I?I=!1:S+=", ",S+=r.map.get(Re[0]).value,h<y(S))return o.value.size+" selected";return S}else for(let u of o.value)return console.log(u,u[0],r.map.get(u[0]),r.map),r.map.get(u[0]).value;return"No selection"}),{list:je,containerProps:We,wrapperProps:$e}=de(f,{itemHeight:32});return(i,u)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.showSelected?(e.openBlock(),e.createElementBlock("div",ke,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),h=>{var S;return e.openBlock(),e.createElementBlock("div",{key:h,onClick:I=>E(h[0]),class:"selection-badge"},[e.createTextVNode(e.toDisplayString((S=e.unref(r).find(I=>I.key==h[0]))==null?void 0:S.value)+" ",1),e.createElementVNode("div",{class:"selection-remove",innerHTML:n.removeIcon},null,8,_e)],8,ve)}),128))])):e.createCommentVNode("",!0),e.createElementVNode("input",{onFocus:u[0]||(u[0]=h=>g.value=!0),onClick:u[1]||(u[1]=h=>g.value=!0),ref_key:"inputNode",ref:p,value:e.unref(De),class:"extra-select extra-select-input",readonly:""},null,40,Ee),O.value?(e.openBlock(),e.createBlock(e.Teleport,{key:1,to:O.value},[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass(["extra-select dropdown",{searching:e.unref(k)>0}]),ref_key:"dropdownNode",ref:w,style:e.normalizeStyle(e.unref(Q))},[n.search?(e.openBlock(),e.createElementBlock("div",be,[e.withDirectives(e.createElementVNode("input",{ref_key:"searchNode",ref:m,class:"extra-select-search","onUpdate:modelValue":u[2]||(u[2]=h=>e.isRef(c)?c.value=h:null),type:"text",autocomplete:"off",autocorrect:"off",autocapitilize:"off",spellcheck:"false",placeholder:"Cerca..."},null,512),[[e.vModelText,e.unref(c)]])])):e.createCommentVNode("",!0),e.unref(c).length>=n.minChars?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(a)?(e.openBlock(),e.createElementBlock("div",Oe,[e.unref(c).length==0?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:_,class:"all-select"},[e.createElementVNode("div",Ce,[e.createElementVNode("input",{checked:e.unref(N),type:"checkbox"},null,8,Se),xe])])):e.createCommentVNode("",!0),e.unref(f).length>0&&e.unref(c).length>0?(e.openBlock(),e.createElementBlock("div",{key:1,onClick:b,class:"all-select"},[e.createElementVNode("div",Ne,[e.createElementVNode("input",{checked:e.unref(P),type:"checkbox"},null,8,Be),Ve])])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"clear",onClick:v},"Clear")])):e.createCommentVNode("",!0),e.unref(f).length==0?(e.openBlock(),e.createElementBlock("div",Ie,"No matches found")):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("div",Te,"Insert at least "+e.toDisplayString(n.minChars)+" characters",1)),e.createElementVNode("div",e.mergeProps(e.unref(We),{class:"scroller"}),[e.createElementVNode("div",e.normalizeProps(e.guardReactiveProps(e.unref($e))),[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(je),h=>(e.openBlock(),e.createElementBlock("button",{key:h.index,class:"dropdown-row",onClick:e.withModifiers(S=>E(h.data.key),["stop","prevent"]),style:{height:"32px"}},[e.createElementVNode("div",Le,[e.unref(a)?(e.openBlock(),e.createElementBlock("input",{key:0,checked:e.unref(o).has(h.data.key),type:"checkbox"},null,8,Ae)):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(h.data.value),1)])],8,Pe))),128))],16)],16)],6),[[e.vShow,g.value]])],8,["to"])):e.createCommentVNode("",!0),n.originalNode?(e.openBlock(),e.createBlock(e.Teleport,{key:2,to:n.originalNode},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),h=>(e.openBlock(),e.createElementBlock("option",{key:h[0],selected:"selected",value:h[0]},null,8,Me))),128))],8,["to"])):e.createCommentVNode("",!0)],64))}},M={init:function(){document.querySelectorAll(".extraselect").forEach(function(t){M.bindNew(t)})},bindNew(t){B.lock(t,"extra-select",()=>{const l={};for(let r in t.dataset)try{l[r]=JSON.parse(t.dataset[r])}catch{l[r]=t.dataset[r]}l.originalNode=t;const n=document.createElement("div");t.parentNode.insertBefore(n,t.nextSibling),n.dataset.isVue=!0,n.style.display="contents";const a=e.createApp(ze,l);a.mount(n),t.addEventListener("remove",function(){a.unmount(),n.remove(),t.remove(),B.remove(t,"extra-select")})})}};return document.addEventListener("DOMContentLoaded",function(){M.init()}),M}(Vue);
